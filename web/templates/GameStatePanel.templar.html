<!-- GameStatePanel Template - Rendered by presenter -->
<!-- Data: . is *BaseGameStatePanel with Game, State, PlayerStats, and computed fields -->
<div class="game-state-panel h-full bg-white dark:bg-gray-800 p-3 overflow-y-auto text-sm">

  <!-- Round/Turn Info -->
  <div class="mb-3">
    <div class="text-sm text-gray-900 dark:text-white">
      {{ if .State }}<span class="font-semibold">Round {{ .State.TurnCounter }}</span>{{ end }}{{ if and .Game .Game.Config .Game.Config.Settings }}{{ if gt .Game.Config.Settings.MaxTurns 0 }} <span class="text-gray-500 dark:text-gray-400">/ {{ .Game.Config.Settings.MaxTurns }}</span>{{ end }}{{ end }}
    </div>
  </div>

  <!-- Current Player Coins/Income Summary -->
  {{ if gt .CurrentPlayerIncome 0 }}
  <div class="mb-4 pb-3 border-b border-gray-200 dark:border-gray-700">
    <div class="flex items-center mb-1">
      <span class="text-yellow-500 mr-1.5 text-base">&#x1F4B0;</span>
      <span class="font-bold text-lg text-gray-900 dark:text-white">{{ .CurrentPlayerCoins }}</span>
    </div>
    <div class="text-xs text-gray-600 dark:text-gray-400">
      Income <span class="font-semibold text-green-600 dark:text-green-400">{{ .CurrentPlayerIncome }}</span>{{ if .IncomeBreakdown }} ({{ .IncomeBreakdown }}){{ end }}
    </div>
  </div>
  {{ end }}

  <h4 class="font-medium text-gray-900 dark:text-white mb-3 text-xs uppercase tracking-wide">
    Players
  </h4>

  <!-- Players List -->
  {{ if and .Game .Game.Config .Game.Config.Players }}
  <div class="space-y-2">
    {{ range .Game.Config.Players }}
    {{ $isCurrentPlayer := eq .PlayerId $.State.CurrentPlayer }}
    {{ $stats := index $.PlayerStats .PlayerId }}
    {{ $playerState := index $.State.PlayerStates .PlayerId }}
    {{ $playerColor := $.GetPlayerColorHex .PlayerId }}
    {{ $isOpen := eq .PlayerType "open" }}
    {{ $isAI := eq .PlayerType "ai" }}
    {{ $isJoinable := $.IsPlayerJoinable . }}
    <div class="player-row flex items-center rounded-lg p-2 {{ if $isCurrentPlayer }}bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700{{ else }}bg-gray-50 dark:bg-gray-700/50{{ end }}">
      <!-- Player Color Square -->
      <div class="w-8 h-8 rounded flex-shrink-0 mr-3" style="background-color: {{ $playerColor }};"></div>
      <!-- Player Info -->
      <div class="flex-1 min-w-0">
        <!-- Player Name Row -->
        <div class="flex items-center">
          <span class="font-medium text-sm text-gray-900 dark:text-white truncate">{{ if .Name }}{{ .Name }}{{ else }}Player {{ .PlayerId }}{{ end }}</span>
          {{ if $isCurrentPlayer }}
          <span class="text-yellow-600 dark:text-yellow-400 text-xs ml-1">&#x25C0;</span>
          {{ end }}
          {{ if $isOpen }}
          <span class="ml-2 px-1.5 py-0.5 text-xs rounded bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300">Open</span>
          {{ else if $isAI }}
          <span class="ml-2 px-1.5 py-0.5 text-xs rounded bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300">AI</span>
          {{ end }}
        </div>
        <!-- Player Stats Row -->
        <div class="flex items-center space-x-3 text-xs text-gray-600 dark:text-gray-400 mt-0.5">
          <!-- Bases Count -->
          <div class="flex items-center" title="Bases owned">
            <span class="mr-0.5">&#x1F3E0;</span>
            <span>{{ if $stats }}{{ $stats.Bases }}{{ else }}0{{ end }}</span>
          </div>
          <!-- Units Count -->
          <div class="flex items-center" title="Units">
            <span class="mr-0.5">&#x1F464;</span>
            <span>{{ if $stats }}{{ $stats.Units }}{{ else }}0{{ end }}</span>
          </div>
          <!-- Coins -->
          <div class="flex items-center" title="Coins">
            <span class="text-yellow-500 mr-0.5">&#x26A1;</span>
            <span>{{ if $playerState }}{{ $playerState.Coins }}{{ else }}0{{ end }}</span>
          </div>
        </div>
      </div>
      <!-- Join Button (only for open slots when viewer can join) -->
      {{ if $isJoinable }}
      <button
        class="join-game-btn ml-2 px-3 py-1.5 text-xs font-medium rounded bg-green-600 hover:bg-green-700 text-white transition-colors"
        data-player-id="{{ .PlayerId }}"
        title="Join as this player">
        Join
      </button>
      {{ end }}
    </div>
    {{ end }}
  </div>
  {{ end }}
</div>
