<!-- World Editor Tools Panel -->
{{ define "ToolsPanel" }}
<div id="tools-panel" class="h-full max-h-full flex flex-col">
  <!-- Tab Navigation -->
  <div
    class="flex border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"
  >
    <button
      id="tiles-tab"
      class="tab-button flex-1 px-4 py-3 text-sm font-medium text-center transition-colors border-b-2 border-transparent hover:text-gray-700 dark:hover:text-gray-300 active-tab"
      data-tab="tiles"
    >
      Tiles (T)
    </button>
    <button
      id="unit-tab"
      class="tab-button flex-1 px-4 py-3 text-sm font-medium text-center transition-colors border-b-2 border-transparent hover:text-gray-700 dark:hover:text-gray-300"
      data-tab="unit"
    >
      Units (U)
    </button>
  </div>

  <!-- Tab Content -->
  <div class="flex-1 overflow-y-auto">
    <!-- Tiles Tab Content (Nature + Crossings + City) -->
    <div id="tiles-tab-content" class="tab-content p-4">
      <div class="space-y-4">
        <!-- Clear Button -->
        <div>
          <button
            class="terrain-button w-full p-2 text-center border border-red-300 dark:border-red-600 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors bg-red-50 dark:bg-red-900/20"
            data-terrain="0"
            data-tiles-index="0"
            title="Clear - Remove tile, unit, and crossing"
          >
            <div class="flex items-center justify-center gap-2">
              <span class="text-lg">üóëÔ∏è</span>
              <span class="text-sm font-medium">Clear</span>
            </div>
          </button>
        </div>

        <!-- Nature Terrains Section -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Nature</h3>
          <div
            id="nature-terrain-palette"
            class="grid grid-cols-3 gap-2 w-full"
          >
            {{ $natureIndex := 1 }} {{ range .NatureTerrains }}
            <button
              class="terrain-button p-2 text-xs text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors{{ if eq .ID 5 }} bg-blue-100 dark:bg-blue-900 border-blue-500{{ end }} overflow-hidden"
              data-terrain="{{ .ID }}"
              data-tiles-index="{{ $natureIndex }}"
              title="{{ .Name }}{{ if ne .ID 0 }} (Move: {{ .BaseMoveCost }}, Defense: {{ .DefenseBonus }}){{ end }}"
            >
              {{ $natureIndex = Add $natureIndex 1 }}
              {{ if .IconDataURL }}
              <div class="flex justify-center mb-1">
                <img
                  src="{{ .IconDataURL }}"
                  alt="{{ .Name }}"
                  class="w-10 h-10 object-contain"
                />
              </div>
              {{ else }}
              <div class="text-sm">üé®</div>
              {{ end }}
              <div class="text-xs truncate">{{ .Name }}</div>
            </button>
            {{ end }}
          </div>
        </div>

        <!-- Divider -->
        <hr class="border-gray-200 dark:border-gray-700" />

        <!-- Crossings Section -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Crossings</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">
            Click to place. Click again to remove.
          </p>
          <div id="crossings-palette" class="grid grid-cols-2 gap-2">
            {{ $crossingIndex := 1 }} {{ range .Crossings }}
            <button
              class="crossing-button p-2 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors overflow-hidden"
              data-crossing="{{ .ID }}"
              data-crossing-index="{{ $crossingIndex }}"
              title="{{ .Name }}"
            >
              {{ $crossingIndex = Add $crossingIndex 1 }} {{ if .IconDataURL }}
              <div class="flex justify-center mb-1">
                <img
                  src="{{ .IconDataURL }}"
                  alt="{{ .Name }}"
                  class="w-10 h-10 object-contain"
                />
              </div>
              {{ else }}
              <div class="text-lg">üõ§Ô∏è</div>
              {{ end }}
              <div class="text-xs truncate">{{ .Name }}</div>
            </button>
            {{ end }}
          </div>

          <!-- Crossing Direction Preset Selector -->
          <div class="mt-3">
            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Direction Preset:</label>
            <div id="crossing-direction-preset" class="flex flex-col gap-2">
              <!-- Interactive Hex with clickable directions -->
              <div class="relative w-32 h-32 flex-shrink-0 mx-auto">
                <svg viewBox="0 0 100 100" class="w-full h-full">
                  <!-- Center hex (visual reference) -->
                  <polygon points="50,15 85,32.5 85,67.5 50,85 15,67.5 15,32.5"
                           fill="none" stroke="currentColor" stroke-width="1" class="text-gray-300 dark:text-gray-600"/>

                  <!-- Direction indicators (clickable) -->
                  <!-- 0: LEFT (-1,0) - default active for horizontal preset -->
                  <line id="crossing-dir-0" x1="50" y1="50" x2="15" y2="50"
                        stroke-width="8" stroke-linecap="round" class="cursor-pointer"
                        stroke="#d97706"/>

                  <!-- 1: TOP_LEFT (0,-1) -->
                  <line id="crossing-dir-1" x1="50" y1="50" x2="32.5" y2="23.75"
                        stroke-width="8" stroke-linecap="round" class="cursor-pointer"
                        stroke="#d1d5db"/>

                  <!-- 2: TOP_RIGHT (1,-1) -->
                  <line id="crossing-dir-2" x1="50" y1="50" x2="67.5" y2="23.75"
                        stroke-width="8" stroke-linecap="round" class="cursor-pointer"
                        stroke="#d1d5db"/>

                  <!-- 3: RIGHT (1,0) - default active for horizontal preset -->
                  <line id="crossing-dir-3" x1="50" y1="50" x2="85" y2="50"
                        stroke-width="8" stroke-linecap="round" class="cursor-pointer"
                        stroke="#d97706"/>

                  <!-- 4: BOTTOM_RIGHT (0,1) -->
                  <line id="crossing-dir-4" x1="50" y1="50" x2="67.5" y2="76.25"
                        stroke-width="8" stroke-linecap="round" class="cursor-pointer"
                        stroke="#d1d5db"/>

                  <!-- 5: BOTTOM_LEFT (-1,1) -->
                  <line id="crossing-dir-5" x1="50" y1="50" x2="32.5" y2="76.25"
                        stroke-width="8" stroke-linecap="round" class="cursor-pointer"
                        stroke="#d1d5db"/>

                  <!-- Center dot -->
                  <circle cx="50" cy="50" r="4" fill="currentColor" class="text-gray-500"/>
                </svg>
              </div>

              <!-- Quick presets dropdown -->
              <select id="crossing-preset-select" class="w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                <option value="horizontal">Horizontal (L-R)</option>
                <option value="diagonal-tlbr">Diagonal (TL-BR)</option>
                <option value="diagonal-trbl">Diagonal (TR-BL)</option>
                <option value="t-left">T-Junction Left</option>
                <option value="t-right">T-Junction Right</option>
                <option value="cross">Crossroad (4-way)</option>
                <option value="custom">Custom</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Divider -->
        <hr class="border-gray-200 dark:border-gray-700" />

        <!-- City Terrains Section -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Structures</h3>
          <!-- Player Color Selection -->
          <div class="mb-2">
            <label
              class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"
              >Player Color:</label
            >
            <select
              id="player-color"
              class="block w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            >
              <option value="0">Neutral (Gray)</option>
              <option value="1">Player 1 (Blue)</option>
              <option value="2">Player 2 (Red)</option>
              <option value="3">Player 3 (Yellow)</option>
              <option value="4">Player 4 (Grey)</option>
              <option value="5">Player 5 (Pink)</option>
              <option value="6">Player 6 (Orange)</option>
              <option value="7">Player 7 (Jungle)</option>
              <option value="8">Player 8 (Green)</option>
              <option value="9">Player 9 (Dark Blue)</option>
              <option value="10">Player 10 (Brown)</option>
              <option value="11">Player 11 (Light Blue)</option>
              <option value="12">Player 12 (Purple)</option>
            </select>
          </div>

          <!-- City Terrain Palette -->
          <div id="city-terrain-palette" class="grid grid-cols-3 gap-2">
            {{ $cityIndex := 100 }} {{ range .CityTerrains }}
            <button
              class="terrain-button p-2 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors overflow-hidden"
              data-terrain="{{ .ID }}"
              data-tiles-index="{{ $cityIndex }}"
              data-has-colors="true"
              title="{{ .Name }} (Move: {{ .BaseMoveCost }}, Defense: {{ .DefenseBonus }})"
            >
              {{ $cityIndex = Add $cityIndex 1 }} {{ if .IconDataURL }}
              <div class="flex justify-center mb-1">
                <img
                  src="{{ .IconDataURL }}"
                  alt="{{ .Name }}"
                  class="w-10 h-10 object-contain"
                />
              </div>
              {{ else }}
              <div class="text-sm">üèôÔ∏è</div>
              {{ end }}
              <div class="text-xs truncate">{{ .Name }}</div>
            </button>
            {{ end }}
          </div>
        </div>
      </div>
    </div>

    <!-- Unit Tab Content -->
    <div id="unit-tab-content" class="tab-content p-4 hidden">
      <div class="space-y-3">
        <!-- Player Color Selection for Units -->
        <div>
          <label
            class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"
            >Unit Player:</label
          >
          <select
            id="unit-player-color"
            class="block w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          >
            <option value="1">Player 1 (Blue)</option>
            <option value="2">Player 2 (Red)</option>
            <option value="3">Player 3 (Yellow)</option>
            <option value="4">Player 4 (Grey)</option>
            <option value="5">Player 5 (Pink)</option>
            <option value="6">Player 6 (Orange)</option>
            <option value="7">Player 7 (Jungle)</option>
            <option value="8">Player 8 (Green)</option>
            <option value="9">Player 9 (Dark Blue)</option>
            <option value="10">Player 10 (Brown)</option>
            <option value="11">Player 11 (Light Blue)</option>
            <option value="12">Player 12 (Purple)</option>
          </select>
        </div>

        <!-- Unit Palette -->
        <div
          id="unit-palette"
          class="grid grid-cols-3 gap-2"
        >
          {{ $unitIndex := 1 }} {{ range .UnitTypes }}
          <button
            class="unit-button p-2 text-center border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors overflow-hidden"
            data-unit="{{ .Id }}"
            data-unit-index="{{ $unitIndex }}"
            title="{{ .Name }}"
          >
            {{ $unitIndex = Add $unitIndex 1 }} {{ if .IconDataURL }}
            <div class="flex justify-center mb-1">
              <img
                src="{{ .IconDataURL }}"
                alt="{{ .Name }}"
                class="w-10 h-10 object-contain"
              />
            </div>
            {{ else }}
            <div class="text-sm">ü™ñ</div>
            {{ end }}
            <div class="text-xs truncate">{{ .Name }}</div>
          </button>
          {{ end }}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .tab-button.active-tab {
    color: #2563eb;
    border-bottom-color: #2563eb;
    background-color: white;
  }
  .dark .tab-button.active-tab {
    color: #60a5fa;
    border-bottom-color: #60a5fa;
    background-color: #1f2937;
  }
  .tab-button:not(.active-tab) {
    color: #6b7280;
  }
  .dark .tab-button:not(.active-tab) {
    color: #9ca3af;
  }
</style>
{{ end }}
