<!-- goapplib/templates/BasePage.html -->
<!--
USAGE WITH NAMESPACES:
{{#/*
  {{# namespace "Base" "goapplib/BasePage.html" #}}
  {{# extend "Base:BasePage" "MyBasePage" "Base:HeaderSection" "MyHeader" #}}

  {{ define "MyHeader" }}
    <!-- Custom header -->
  {{ end }}
*/#}}

CUSTOMIZABLE BLOCKS:
- TitleSection: Page title
- CSSSection: CSS includes
- HTMXSection: HTMX script
- ExtraHeadSection: Additional head content
- SplashScreenSection: Splash screen
- HeaderSection: Header and navigation drawer
- BodySection: Main page content
- ModalSection: Modal container
- ToastSection: Toast container
- FooterSection: Footer content
- AppContainerSection: Container for JS frameworks
- AppScriptSection: Main app script
- PreScriptsSection: Scripts before theme toggle
- PostScriptsSection: Scripts at end of body
-->
{{# include "./Header.html" #}}
{{# include "./components/Modal.html" #}}
{{# include "./components/Toast.html" #}}
{{# include "./components/SplashScreen.html" #}}

{{ define "BasePage" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{ block "TitleSection" . }}<title>{{ .Title }}</title>{{ end }}

    <!-- Theme initialization (before CSS to prevent flash) -->
    <script>
    if (localStorage.getItem('theme') === 'dark' ||
        (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
    </script>

    <!-- CSS -->
    {{ block "CSSSection" . }}
    <link href="/static/css/tailwind.css" rel="stylesheet">
    {{ end }}

    <!-- HTMX -->
    {{ block "HTMXSection" . }}
    <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>
    {{ end }}

    {{ block "ExtraHeadSection" . }}{{ end }}
</head>

<body class="{{ or .BodyClass "h-screen flex flex-col bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200" }}" {{ .BodyDataAttributes | safeHTMLAttr }}>

    <!-- Splash Screen -->
    {{ if not .DisableSplashScreen }}
    {{ block "SplashScreenSection" . }}
        {{ template "SimpleSplashScreen" . }}
    {{ end }}
    {{ end }}

    <!-- Header -->
    {{ block "HeaderSection" . }}
        {{ if not .CustomHeader }}
        <div class="print:hidden sticky left-0 top-0 z-20 border-b border-gray-200 dark:border-gray-700">
            {{ template "Header" .Header }}
        </div>
        <!-- Header Actions Drawer (sibling of header, not child) -->
        {{ template "HeaderActionsDrawer" . }}
        {{ end }}
    {{ end }}

    <!-- Main Body Content -->
    {{ block "BodySection" . }}
    <main class="flex-1 overflow-auto">
        <!-- Override this block in your page templates -->
    </main>
    {{ end }}

    <!-- Modal Container -->
    {{ block "ModalSection" . }}
    <div id="modal-container" class="hidden fixed inset-0 z-50">
        {{ template "ModalContainer" . }}
    </div>
    {{ end }}

    <!-- Toast Container -->
    {{ block "ToastSection" . }}
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2">
        {{ template "ToastContainer" . }}
    </div>
    {{ end }}

    <!-- Footer -->
    {{ block "FooterSection" . }}{{ end }}

    <!-- App container for JS frameworks -->
    {{ block "AppContainerSection" . }}{{ end }}

    <!-- Main app script -->
    {{ block "AppScriptSection" . }}{{ end }}

    <!-- Pre-body scripts -->
    {{ block "PreScriptsSection" . }}{{ end }}

    <!-- Theme toggle script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Hide splash screen
        const splash = document.getElementById('splash-screen');
        if (splash) {
            splash.style.opacity = '0';
            setTimeout(() => splash.remove(), 300);
        }
    });
    </script>

    <!-- Post-body scripts -->
    {{ block "PostScriptsSection" . }}{{ end }}
</body>
</html>
{{ end }}
