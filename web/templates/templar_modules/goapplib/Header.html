<!-- goapplib/templates/Header.html -->
<!--
USAGE WITH NAMESPACES:
{{#/*
    {{# namespace "H" "goapplib/Header.html" #}}
    {{# extend "H:Header" "MyHeader" "H:NavigationTabs" "MyNavTabs" #}}

    {{ define "MyNavTabs" }}
        <a href="/games">Games</a>
        <a href="/worlds">Worlds</a>
    {{ end }}
*/#}}

CUSTOMIZABLE BLOCKS:
- HeaderLogo: Logo and app name
- NavigationTabs: Center navigation links (data-driven or block override)
- HeaderActions: Right-side action buttons
- ExtraHeaderButtons: Additional buttons in drawer
-->

{{ define "Header" }}
<header class="bg-white dark:bg-gray-800 shadow-sm px-4 py-3 flex items-center justify-between">
    <!-- Logo and Site Name -->
    <div class="flex items-center space-x-2">
        {{ template "HeaderLogo" . }}
    </div>

    <!-- Right Actions -->
    <div class="flex items-center space-x-2">
        <!-- Mobile menu button (drawer trigger) -->
        <button id="header-actions-menu-btn" type="button"
                class="md:hidden p-2 rounded-md text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700"
                aria-label="Menu">
            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
            </svg>
        </button>

        {{ template "HeaderActions" . }}

        <!-- Theme toggle -->
        <button id="theme-toggle-button" type="button"
                class="p-2 rounded-md text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700"
                aria-label="Toggle theme">
            <span id="theme-toggle-icon">
                <span class="dark:hidden">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                </span>
                <span class="hidden dark:inline">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                </span>
            </span>
        </button>
    </div>
</header>
{{ end }}

<!-- Default logo block -->
{{ define "HeaderLogo" }}
<a href="/" class="flex items-center space-x-2">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600 dark:text-blue-400" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
    </svg>
    <span class="font-bold text-xl text-gray-900 dark:text-white">{{ or .AppName "App" }}</span>
</a>
{{ end }}

<!-- Default actions - login/logout buttons -->
{{ define "HeaderActions" }}
{{ if .IsLoggedIn }}
<a href="/profile" class="hidden md:flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
    </svg>
    <span>{{ or .Username "Profile" }}</span>
</a>
<a href="/auth/logout" class="hidden md:inline-flex items-center px-3 py-2 rounded-md text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
    </svg>
</a>
{{ else }}
<a href="/login" class="hidden md:inline-flex items-center px-3 py-2 rounded-md text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
    <svg class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
    </svg>
    Login
</a>
{{ end }}
{{ end }}

<!-- Default navigation tabs - data-driven with fallback to block override -->
{{ define "NavigationTabs" }}
<nav class="navigation-tabs-container md:mr-auto">
    {{ range .NavigationItems }}
    <a href="{{ .Href }}" class="navigation-tab {{ if .Active }}active{{ end }}">
        {{ .Label }}
    </a>
    {{ end }}
</nav>
{{ end }}

<!-- Extra header buttons slot - pages define ExtraHeaderButtons to add buttons here -->

<!-- Header Actions Drawer - Responsive navigation drawer -->
{{ define "HeaderActionsDrawer" }}
<div id="header-actions-drawer" class="print:hidden fixed z-[60] hidden">
    <!-- Backdrop (mobile only) -->
    <div class="header-drawer-backdrop absolute inset-0 transition-opacity duration-300 md:hidden"></div>

    <!-- Drawer Container -->
    <div class="header-drawer-container bg-white dark:bg-gray-800 transition-transform duration-300 ease-out">
        <!-- Drawer Content -->
        <div class="header-actions-drawer-content p-4 md:p-0 space-y-2 md:space-y-0">
            <!-- Navigation Tabs -->
            {{ template "NavigationTabs" . }}

            <!-- User Actions (mobile only) -->
            <div class="md:hidden flex flex-col space-y-2 pt-2 border-t border-gray-200 dark:border-gray-700">
                {{ if .Header.IsLoggedIn }}
                <a href="/profile" class="flex items-center space-x-2 px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    <span>{{ or .Header.Username "Profile" }}</span>
                </a>
                <a href="/auth/logout" class="flex items-center space-x-2 px-4 py-2 rounded-md text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                    <span>Logout</span>
                </a>
                {{ else }}
                <a href="/login" class="flex items-center space-x-2 px-4 py-2 rounded-md text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
                    </svg>
                    <span>Login</span>
                </a>
                {{ end }}
            </div>

            <!-- Page-specific buttons (pages override by defining ExtraHeaderButtons) -->
            {{ block "ExtraHeaderButtons" . }}{{ end }}
        </div>
    </div>
</div>

<style>
/* Navigation tabs styling */
.navigation-tabs-container {
    display: flex;
    gap: 0.25rem;
}

.navigation-tab {
    display: block;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s;
    color: #374151;
}

.dark .navigation-tab {
    color: #D1D5DB;
}

.navigation-tab:hover {
    background-color: #F3F4F6;
}

.dark .navigation-tab:hover {
    background-color: #374151;
}

.navigation-tab.active {
    background-color: #DBEAFE;
    color: #1D4ED8;
}

.dark .navigation-tab.active {
    background-color: rgba(30, 58, 138, 0.5);
    color: #BFDBFE;
}

/* Desktop: Drawer appears inline with header */
@media (min-width: 768px) {
    #header-actions-drawer {
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        height: 70px;
        width: auto;
        z-index: 25;
        pointer-events: none;
    }

    #header-actions-drawer .header-drawer-container {
        background: transparent;
        box-shadow: none;
        border: none;
        transform: none;
        height: 100%;
        display: flex;
        align-items: center;
    }

    #header-actions-drawer .header-actions-drawer-content {
        padding: 0;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 1rem;
        height: 100%;
        pointer-events: auto;
    }

    #header-actions-drawer .header-drawer-backdrop {
        display: none;
    }

    #header-actions-drawer {
        display: block !important;
    }

    .navigation-tabs-container {
        flex-direction: row;
    }
}

/* Mobile: Drawer slides from top */
@media (max-width: 767px) {
    #header-actions-drawer {
        inset: 0;
    }

    #header-actions-drawer.hidden {
        pointer-events: none;
    }

    #header-actions-drawer.open {
        pointer-events: auto;
    }

    #header-actions-drawer .header-drawer-container {
        position: absolute;
        left: 0;
        right: 0;
        top: 70px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        border-bottom: 1px solid #E5E7EB;
        transform: translateY(-100%);
        max-height: calc(100vh - 70px);
        overflow-y: auto;
    }

    .dark #header-actions-drawer .header-drawer-container {
        border-color: #374151;
    }

    #header-actions-drawer.open .header-drawer-container {
        transform: translateY(0);
    }

    #header-actions-drawer .header-drawer-backdrop {
        opacity: 0;
    }

    #header-actions-drawer.open .header-drawer-backdrop {
        opacity: 1;
        background: rgba(0, 0, 0, 0.5);
    }

    #header-actions-drawer .header-actions-drawer-content {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .navigation-tabs-container {
        flex-direction: column;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #E5E7EB;
    }

    .dark .navigation-tabs-container {
        border-color: #374151;
    }

    .navigation-tab {
        width: 100%;
        text-align: left;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const menuBtn = document.getElementById('header-actions-menu-btn');
    const drawer = document.getElementById('header-actions-drawer');
    const backdrop = drawer?.querySelector('.header-drawer-backdrop');

    if (menuBtn && drawer) {
        menuBtn.addEventListener('click', function() {
            drawer.classList.toggle('hidden');
            drawer.classList.toggle('open');
        });

        if (backdrop) {
            backdrop.addEventListener('click', function() {
                drawer.classList.add('hidden');
                drawer.classList.remove('open');
            });
        }
    }
});
</script>
{{ end }}
